version: "3"
services:
  kumo_rabbit:
    image: rabbitmq:3.12.1
    hostname: kumo_official_rabbit
    container_name: kumo_official_rabbit_1
    read_only: true
    ports:
      - 5672:5672
      - 15672:15672
    environment:
      - RABBITMQ_DEFAULT_USER=kumo_user
      - RABBITMQ_DEFAULT_PASS=kumo_password
      - RABBITMQ_NODE_PORT=5672
    volumes:
      - ./database_dir:/var/lib/rabbitmq
      - ./rabbitmq:/etc/rabbitmq
      - official_rabbit:/var/lib/rabbitmq
  # mpc_db:
  #   image: postgres:14
  #   container_name: kumo_mpc_db
  #   ports:
  #     - 5432:5432
  #   environment:
  #     POSTGRES_DB: kumo_mpc_db
  #     POSTGRES_USER: kumo_mpc_db
  #     POSTGRES_PASSWORD: kumo_mpc_db
  #   volumes:
  #     - offical_rabbit:/etc
volumes:
  official_rabbit:
    driver: local

    # command: > 
    #   sh -c "
    #     rabbitmqctl add_user kumo_user kumo_password &&  
    #     rabbitmqctl set_user_tags kumo_user administrator &&
    #     rabbitmqctl set_permissions -p / kumo_user ".*" ".*" ".*" 
    #   "

  # kumo_rabbit_server:
  #   depends_on:
  #     - kumo_rabbit
  #   image: kumo_rabbit_server
  #   container_name: kumo_rabbit_server_1
  #   build:
  #     context: ./
  #   command: >
  #     bash -c "sleep  10s &&  node ./send.js"
  #   # ports:
  #   #   - 3001:3001
  #   # env_file: .env
  #   volumes:
  #     - ./:/usr/app
  #     - ./node_modules:/usr/app/node_modules
